name: Comment Trigger

on:
  issue_comment:
    types: [created]

jobs:
  test:
    if: contains(github.event.comment.body, '/test')
    runs-on: ubuntu-latest
    steps:
    - name: First type
      run: echo "First type ${{ github.event.issue_comment.head.sha }}"
    - name: Second type
      run: echo "Second type ${{ github.event.workflow_run.head_sha }}"
      
  test2:
    runs-on: [ubuntu-latest]
    outputs:
      commit_sha: ${{ steps.variables.outputs.commit_sha }}
    steps:
    - name: Get commit sha
    - id: commit_sha
    - uses: actions/github-script@v6
      with:
        github-token: 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
        script: |
          const pull_request = await github.rest.pulls.get({pull_number: context.issue.number, owner: context.repo.owner, repo: context.repo.repo})
          await github.rest.actions.createWorkflowDispatch({
            owner: context.repo.owner,
            repo: context.repo.repo,
            workflow_id: 'integrations_tests.yml',
            ref: 'main',
            inputs: {
              'commit-sha': pull_request.data.head.sha
              echo "commit_sha=pull_request.data.head.sha" >> $env:GITHUB_OUTPUT
            }
          })
          
    - name: Confirm variables
      run: echo "${{ steps.commit_sha.outputs.commit_sha }}"
